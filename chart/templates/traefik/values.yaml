{{- if .Values.traefik.enabled }}
{{- include "values-secret" (dict "root" $ "package" .Values.traefik "name" "traefik" "defaults" (include "dorkomen.defaults.traefik" .)) }}
{{- end }}

{{- define "dorkomen.defaults.traefik" -}}
# Traefik default values

# Install CRDs (IngressRoute, Middleware, etc.)
crds:
  enabled: true

# Image configuration
image:
  repository: traefik
  pullPolicy: {{ .Values.imagePullPolicy }}

{{- if (include "imagePullSecret" .) }}
imagePullSecrets:
  - name: private-registry
{{- end }}

# Service configuration
service:
  enabled: true
  type: {{ .Values.traefik.service.type | default "LoadBalancer" }}
  {{- if .Values.traefik.service.loadBalancerIP }}
  spec:
    loadBalancerIP: {{ .Values.traefik.service.loadBalancerIP }}
  {{- end }}

# Ports configuration
ports:
  web:
    port: 8000
    exposedPort: 80
    expose:
      default: true
    protocol: TCP
    {{- if .Values.httpsRedirect }}
    redirectTo:
      port: websecure
    {{- end }}
  websecure:
    port: 8443
    exposedPort: 443
    expose:
      default: true
    protocol: TCP
    tls:
      enabled: true

# Disable dashboard ingress route by default (security)
ingressRoute:
  dashboard:
    enabled: {{ .Values.traefik.dashboard.enabled | default false }}

# Logs
logs:
  general:
    level: {{ .Values.traefik.logLevel | default "INFO" }}
  access:
    enabled: {{ .Values.traefik.accessLogs.enabled | default false }}

# Resources
resources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Replicas
deployment:
  replicas: {{ .Values.traefik.replicas | default 1 }}

# Provider configuration
providers:
  kubernetesCRD:
    enabled: true
    allowCrossNamespace: true
  kubernetesIngress:
    enabled: true
    publishedService:
      enabled: true

# Additional arguments
additionalArguments: []

{{- end -}}
